#!/bin/sh

# This script change the base16-eval-theme for emacs generated by pywal with the template. Because the base color is too bright. It also copy the templates for dmenu shits for homogenous colors

#color correction for emacs

hex=$(awk '/base02/' ~/.cache/wal/base16-wal-theme.el | cut -d\" -f2)

r=$(printf '%02x' $(( $((0x$(echo "$hex" | cut -c2,3))) / 2 )))
g=$(printf '%02x' $(( $((0x$(echo "$hex" | cut -c4,5))) / 2 )))
b=$(printf '%02x' $(( $((0x$(echo "$hex" | cut -c6,7))) / 2 )))

sed "/base02/c\                                         :base02 \"#$r$g$b\"" ~/.cache/wal/base16-wal-theme.el > ~/.emacs.d/themes/base16-wal-theme.el

# templates for keepmenu, networkdmenu, cava and dunst

cp ~/.cache/wal/keepmenuconf ~/.config/keepmenu/config.ini
cp ~/.cache/wal/nm_dmenu ~/.config/networkmanager-dmenu/config.ini
cp ~/.cache/wal/cavaconf ~/.config/cava/config
cp ~/.cache/wal/dunstconf ~/.config/dunst/dunstrc

#dunst
dunst &

# animated wallpaper if gif

# pid=$(pgrep xwinwrap)
# [ -n "$pid" ] && kill -10 "$pid"
#
# sleep -1.5
#
# curr_wall=$(grep -o "'.*'" "${HOME}"/.fehbg | sed "s/'//g")
#
# is_gif=$(echo "$curr_wall" | sed 's/.*.\(gif\|webm\)/true/g')
#
# size=$(xrandr | grep current | sed 's/.*current \([0-9]*\) x \([0-9]*\),.*/\1x\2/')
#
# [ "$is_gif" = "true" ] && xwinwrap -ov -g $size+0+0 -- mpv -wid WID "$curr_wall" --no-osc --no-osd-bar --loop-file --player-operation-mode=cplayer --no-audio --panscan=1.0 --no-input-default-bindings
