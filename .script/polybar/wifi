#!/bin/sh


inversebool () {
    [[ "$1" = 0 ]] && echo 1 || echo 0
}

getifstat () {
    ifstat -n
    if [[ -n $(grep wlp /tmp/.ifstat.u"$UID") ]];then
        grep wlp /tmp/.ifstat.u"$UID" | awk '{print $7 " " $9}' | read received transmitted
        received=$(( received - $(cat /tmp/wififstatrxzero 2>/dev/null || echo 0) ))
        transmitted=$(( transmitted - $(cat /tmp/wififstattxzero 2>/dev/null || echo 0) ))
        RX="↓$(mean $received)"
        TX="↑$(mean $transmitted)"
    fi
}

mean () {
    units="KMGTP"
    nummean=$(( $(printf $1 | wc -m) / 3 ))
    number=$(echo "$1 / (10 ^ (3 * $nummean) )" | bc -l | cut -c 1-4)
    unit=$(echo $units | cut -c $nummean)
    echo $number$unit
}

case $1 in
    --help)
        echo "Need help? Go fuck yourself!"
        ;;
    --setup-zeros)
        grep wlp /tmp/.ifstat.u$UID | awk '{print $7 " " $9}' | read rxzero txzero
        echo $txzero > /tmp/wififstattxzero
        echo $rxzero > /tmp/wififstatrxzero
        ;;
    --toggle-ifstat)
        [[ -f /tmp/wififstattglrx ]] && rm /tmp/wififstattglrx || touch /tmp/wififstattglrx
        ;;
    *)
        if [ "$(cat /sys/class/net/enp3s0/operstate)" = "up" ];then
            output="E"
        else
            wifi=$(awk 'NR==3 {print substr($4,2,2)}' /proc/net/wireless)
            if [ ! "$wifi" = "" ];then
	        if [ "$wifi" -le 55 ];then
	            output="A"
	        elif [ "$wifi" -le 75 ];then
	            output="B"
	        elif [ "$wifi" -le 85 ];then
	            output="C"
	        else
	            output="D"
	        fi
            fi
        fi
        [[ -f /tmp/wififstattglrx ]] && output="$output $RX $TX"
        echo "$output"
esac
